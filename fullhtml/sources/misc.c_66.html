
<html>
<head>
  <link rel="stylesheet" href="../style.css"/>
  <script src="../jquery-3.2.1.min.js"></script>
</head>
<body>
<pre><code class="cpp">
<a name="ln1"> </a>
<a name="ln2">// This is an open source non-commercial project. Dear PVS-Studio, please check it.</a>
<a name="ln3"> </a>
<a name="ln4">// PVS-Studio Static Code Analyzer for C, C++ and C#: http://www.viva64.com</a>
<a name="ln5">/*</a>
<a name="ln6"> * Copyright (C) 2004 Andrew Beekhof &lt;andrew@beekhof.net&gt;</a>
<a name="ln7"> *</a>
<a name="ln8"> * This program is free software; you can redistribute it and/or</a>
<a name="ln9"> * modify it under the terms of the GNU General Public</a>
<a name="ln10"> * License as published by the Free Software Foundation; either</a>
<a name="ln11"> * version 2 of the License, or (at your option) any later version.</a>
<a name="ln12"> *</a>
<a name="ln13"> * This software is distributed in the hope that it will be useful,</a>
<a name="ln14"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</a>
<a name="ln15"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</a>
<a name="ln16"> * General Public License for more details.</a>
<a name="ln17"> *</a>
<a name="ln18"> * You should have received a copy of the GNU General Public</a>
<a name="ln19"> * License along with this library; if not, write to the Free Software</a>
<a name="ln20"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</a>
<a name="ln21"> */</a>
<a name="ln22">#include &lt;crm_internal.h&gt;</a>
<a name="ln23"> </a>
<a name="ln24">#include &lt;crm/crm.h&gt;</a>
<a name="ln25">#include &lt;crm/cib.h&gt;</a>
<a name="ln26">#include &lt;crm/msg_xml.h&gt;</a>
<a name="ln27">#include &lt;crm/common/xml.h&gt;</a>
<a name="ln28"> </a>
<a name="ln29">#include &lt;crmd_fsa.h&gt;</a>
<a name="ln30">#include &lt;crmd_messages.h&gt;</a>
<a name="ln31"> </a>
<a name="ln32">/*	A_LOG, A_WARN, A_ERROR	*/</a>
<a name="ln33">void</a>
<a name="ln34">do_log(long long action,</a>
<a name="ln35">       enum crmd_fsa_cause cause,</a>
<a name="ln36">       enum crmd_fsa_state cur_state, enum crmd_fsa_input current_input, fsa_data_t * msg_data)</a>
<a name="ln37">{</a>
<a name="ln38">    unsigned log_type = LOG_TRACE;</a>
<a name="ln39"> </a>
<a name="ln40">    if (action &amp; A_LOG) {</a>
<a name="ln41">        log_type = LOG_INFO;</a>
<a name="ln42">    } else if (action &amp; A_WARN) {</a>
<a name="ln43">        log_type = LOG_WARNING;</a>
<a name="ln44">    } else if (action &amp; A_ERROR) {</a>
<a name="ln45">        log_type = LOG_ERR;</a>
<a name="ln46">    }</a>
<a name="ln47"> </a>
<a name="ln48">    do_crm_log(log_type, &quot;Input %s received in state %s from %s&quot;,</a>
<a name="ln49">               fsa_input2string(msg_data-&gt;fsa_input),</a>
<a name="ln50">               fsa_state2string(cur_state), msg_data-&gt;origin);</a>
<a name="ln51"> </a>
<a name="ln52">    if (msg_data-&gt;data_type == fsa_dt_ha_msg) {</a>
<a name="ln53">        ha_msg_input_t *input = fsa_typed_data(msg_data-&gt;data_type);</a>
<a name="ln54"> </a>
<a name="ln55">        crm_log_xml_debug(input-&gt;msg, __FUNCTION__);</a>
<a name="ln56"> </a>
<a name="ln57">    } else if (msg_data-&gt;data_type == fsa_dt_xml) {</a>
<a name="ln58">        xmlNode *input = fsa_typed_data(msg_data-&gt;data_type);</a>
<a name="ln59"> </a>
<a name="ln60">        crm_log_xml_debug(input, __FUNCTION__);</a>
<a name="ln61"> </a>
<a name="ln62">    } else if (msg_data-&gt;data_type == fsa_dt_lrm) {</a>
<a name="ln63">        lrmd_event_data_t *input = fsa_typed_data(msg_data-&gt;data_type);</a>
<a name="ln64"> </a>
<a name="ln65">        do_crm_log(log_type,</a>
<a name="ln66">                   &quot;Resource %s: Call ID %d returned %d (%d).&quot;</a>
<a name="ln67">                   &quot;  New status if rc=0: %s&quot;,</a>
<a name="ln68">                   input-&gt;rsc_id, input-&gt;call_id, input-&gt;rc,</a>
<a name="ln69">                   input-&gt;op_status, (char *)input-&gt;user_data);</a>
<a name="ln70">    }</a>
<a name="ln71">}</a>

</code></pre>
<div class="balloon" rel="1"><p><span style="font-size:18px">&uarr;</span> <a href="https://www.viva64.com/en/w/V002/" target="_blank">V002</a> Some diagnostic messages may contain incorrect line number in this file.</p></div>

<link rel="stylesheet" href="highlight.css">
<script src="highlight.pack.js"></script>
<script src="highlightjs-line-numbers.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>hljs.initLineNumbersOnLoad();</script>
<script>
  $(document).ready(function() {
      $('.balloon').each(function () {
          var bl = $(this);
          var line = bl.attr('rel');
          var text = $('a[name="ln'+line+'"').text();

          var space_count = 0;
          for(var i = 0; i<text.length; i++){
              var char = text[i];
              if((char !== ' ')&&(char !== '\t'))break;
              if(char === '\t')space_count++;
              space_count++;
          }

          bl.css('margin-left', space_count*8);
          $('a[name="ln'+line+'"').after(bl);
      });

      window.location = window.location;
  });
</script>
</body>
</html>
